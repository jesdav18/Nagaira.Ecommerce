<div class="cart-page">
  <div class="container">
    <h1 class="page-title">Tu Carrito</h1>

    @if (cartService.itemCount() > 0) {
      <div class="cart-grid">
        <!-- Lista de Items -->
        <div class="cart-items">
          @for (item of cartService.cartItems(); track item.product.id) {
            <div class="cart-item">
              <div class="item-image">
                <img
                  [src]="item.product.images && item.product.images.length > 0 ? item.product.images[0].imageUrl : '/assets/placeholder.jpg'"
                  [alt]="item.product.name"
                >
              </div>

              <div class="item-details">
                <a [routerLink]="['/p', item.product.slug]" class="item-name">
                  {{ item.product.name }}
                </a>
                <span class="item-category">{{ item.product.categoryName }}</span>
                <div class="item-price">
                  @if (getItemOfferPrice(item.product) !== null && getItemOfferPrice(item.product)! < getItemPrice(item.product)) {
                    <span class="item-price-original">{{ getItemPrice(item.product) | appCurrency:'1.2-2' }}</span>
                  }
                  <span class="item-price-current">{{ getItemDisplayPrice(item.product) | appCurrency:'1.2-2' }}</span>
                </div>
              </div>

              <div class="item-actions">
                <div class="quantity-control">
                  <button
                    (click)="updateQuantity(item.product.id, item.quantity - 1)"
                    [disabled]="item.quantity <= 1">
                    âˆ’
                  </button>
                  <input type="number" [value]="item.quantity" readonly>
                  <button
                    (click)="updateQuantity(item.product.id, item.quantity + 1)"
                    [disabled]="!canIncrementQuantity(item.product, item.quantity)">
                    +
                  </button>
                </div>

              <div class="item-subtotal">
                  @if (getItemOfferPrice(item.product) !== null && getItemOfferPrice(item.product)! < getItemPrice(item.product)) {
                    <span class="item-price-original">
                      {{ (getItemPrice(item.product) * item.quantity) | appCurrency:'1.2-2' }}
                    </span>
                  }
                  <span class="item-price-current">
                    {{ (getItemDisplayPrice(item.product) * item.quantity) | appCurrency:'1.2-2' }}
                  </span>
              </div>

                <button class="remove-btn" (click)="removeItem(item.product.id)">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          }
        </div>

        <!-- Resumen de Orden -->
        <div class="order-summary">
          <h2 class="summary-title">Resumen de Orden</h2>

          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ discountedSubtotal | appCurrency:'1.2-2' }}</span>
          </div>

          <div class="summary-row">
            <span>Impuestos</span>
            <span>{{ discountedTax | appCurrency:'1.2-2' }}</span>
          </div>

          @if (discountTotal > 0) {
            <div class="summary-row discount-row">
              <span>Descuento</span>
              <span>-{{ discountTotal | appCurrency:'1.2-2' }}</span>
            </div>
          }

          <div class="summary-divider"></div>

          <div class="summary-row total">
            <span>Total</span>
            <span>{{ discountedTotal | appCurrency:'1.2-2' }}</span>
          </div>
          @if (discountTotal > 0) {
            <small class="summary-note">Descuento estimado; el total final se confirma al pagar.</small>
          }

          <a routerLink="/checkout" class="btn btn-primary btn-block checkout-btn">
            Finalizar Compra
          </a>


        </div>
      </div>
    } @else {
      <div class="empty-cart">
        <div class="empty-icon">ðŸ›’</div>
        <h2>Tu carrito estÃ¡ vacÃ­o</h2>
        <p>Â¡Explora nuestros productos y encuentra algo increÃ­ble!</p>
        <a routerLink="/products" class="btn btn-primary">
          Ir a Comprar
        </a>
      </div>
    }
  </div>
</div>
